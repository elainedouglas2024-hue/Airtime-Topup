<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Etopup - Airtime Top-up Service</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding-bottom: 60px;
        }

        .header {
            background: white;
            padding: 15px 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .logo-container {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .logo {
            width: 40px;
            height: 40px;
        }

        .site-name {
            font-size: 24px;
            font-weight: bold;
            color: #667eea;
        }

        .hamburger {
            cursor: pointer;
            padding: 10px;
        }

        .hamburger div {
            width: 25px;
            height: 3px;
            background-color: #333;
            margin: 5px 0;
            transition: 0.3s;
        }

        .container {
            max-width: 500px;
            margin: 20px auto;
            padding: 0 20px;
        }

        .card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 20px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        .section-title {
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 15px;
            color: #333;
        }

        .provider-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            margin-bottom: 20px;
        }

        .provider-option {
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            padding: 15px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
        }

        .provider-option:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 10px rgba(0,0,0,0.1);
        }

        .provider-option.selected {
            border-color: #667eea;
            background: #f0f4ff;
        }

        .provider-option img {
            width: 60px;
            height: 60px;
            object-fit: contain;
            margin-bottom: 8px;
        }

        .provider-option span {
            display: block;
            font-size: 14px;
            font-weight: 500;
            color: #333;
        }

        .form-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: #333;
            font-size: 14px;
        }

        .tooltip-icon {
            display: inline-block;
            width: 16px;
            height: 16px;
            background: #667eea;
            color: white;
            border-radius: 50%;
            text-align: center;
            line-height: 16px;
            font-size: 12px;
            margin-left: 5px;
            cursor: help;
            position: relative;
        }

        .tooltip-icon:hover::after {
            content: attr(data-tooltip);
            position: absolute;
            bottom: 125%;
            left: 50%;
            transform: translateX(-50%);
            background: #333;
            color: white;
            padding: 8px 12px;
            border-radius: 5px;
            white-space: nowrap;
            font-size: 12px;
            z-index: 10;
        }

        input {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s;
        }

        input:focus {
            outline: none;
            border-color: #667eea;
        }

        input.error {
            border-color: #f44336;
        }

        .error-message {
            color: #f44336;
            font-size: 12px;
            margin-top: 5px;
            display: none;
        }

        .btn {
            width: 100%;
            padding: 15px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: transform 0.2s;
        }

        .btn:hover {
            transform: translateY(-2px);
        }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        /* Popup/Modal Styles */
        .popup-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.7);
            z-index: 1000;
            overflow-y: auto;
        }

        .popup-overlay.active {
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .popup-content {
            background: white;
            border-radius: 15px;
            padding: 25px;
            max-width: 500px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
            position: relative;
        }

        .close-btn {
            position: absolute;
            top: 15px;
            right: 15px;
            width: 30px;
            height: 30px;
            background: #f44336;
            color: white;
            border: none;
            border-radius: 50%;
            font-size: 20px;
            cursor: pointer;
            line-height: 30px;
            text-align: center;
        }

        .popup-title {
            font-size: 22px;
            font-weight: bold;
            margin-bottom: 15px;
            color: #333;
            padding-right: 30px;
        }

        .popup-text {
            line-height: 1.6;
            color: #666;
        }

        /* Loading Spinner */
        .loading-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.8);
            z-index: 2000;
            align-items: center;
            justify-content: center;
            flex-direction: column;
        }

        .loading-overlay.active {
            display: flex;
        }

        .spinner {
            width: 80px;
            height: 80px;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .loading-text {
            color: white;
            font-size: 18px;
            margin-top: 20px;
            font-weight: 500;
        }

        /* News Section */
        .news-section {
            margin-top: 30px;
        }

        .news-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .news-title {
            font-size: 20px;
            font-weight: bold;
            color: white;
        }

        .news-controls {
            display: flex;
            gap: 10px;
        }

        .news-btn {
            background: white;
            border: none;
            width: 35px;
            height: 35px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 18px;
            color: #667eea;
        }

        .news-item {
            background: white;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 10px;
            cursor: pointer;
            transition: transform 0.2s;
        }

        .news-item:hover {
            transform: translateX(5px);
        }

        .news-item h3 {
            font-size: 16px;
            margin-bottom: 8px;
            color: #333;
        }

        .news-item p {
            font-size: 14px;
            color: #666;
            line-height: 1.4;
        }

        /* Notification Ticker */
        .notification-ticker {
            position: fixed;
            bottom: 60px;
            left: 0;
            width: 100%;
            background: #4caf50;
            color: white;
            padding: 10px 0;
            overflow: hidden;
            z-index: 99;
        }

        .ticker-content {
            display: flex;
            animation: scroll 20s linear infinite;
            white-space: nowrap;
        }

        .ticker-item {
            padding: 0 50px;
            font-size: 14px;
        }

        @keyframes scroll {
            0% { transform: translateX(100%); }
            100% { transform: translateX(-100%); }
        }

        /* Footer */
        .footer {
            background: white;
            padding: 20px;
            text-align: center;
            position: fixed;
            bottom: 0;
            width: 100%;
            box-shadow: 0 -2px 10px rgba(0,0,0,0.1);
        }

        .footer-links {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 15px;
            margin-bottom: 10px;
        }

        .footer-links a {
            color: #667eea;
            text-decoration: none;
            font-size: 12px;
        }

        .footer-links a:hover {
            text-decoration: underline;
        }

        .copyright {
            font-size: 12px;
            color: #666;
        }

        @media (max-width: 480px) {
            .provider-grid {
                grid-template-columns: repeat(3, 1fr);
                gap: 10px;
            }

            .provider-option {
                padding: 10px;
            }

            .provider-option img {
                width: 50px;
                height: 50px;
            }
        }
    </style>
</head>
<body>
    <!-- Header -->
    <div class="header">
        <div class="logo-container">
            <svg class="logo" viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">
                <circle cx="50" cy="50" r="45" fill="#667eea"/>
                <path d="M30 50 L50 30 L70 50 L50 70 Z" fill="white"/>
                <circle cx="50" cy="50" r="8" fill="#764ba2"/>
                <path d="M50 25 Q65 35 50 50 Q35 35 50 25" fill="#ffd700" opacity="0.8"/>
            </svg>
            <span class="site-name">Etopup</span>
        </div>
        <div class="hamburger" onclick="toggleMenu()">
            <div></div>
            <div></div>
            <div></div>
        </div>
    </div>

    <!-- Main Container -->
    <div class="container">
        <!-- Provider Selection -->
        <div class="card">
            <div class="section-title">Select Provider</div>
            <div class="provider-grid">
                <div class="provider-option" onclick="selectProvider('safaricom')" id="provider-safaricom">
                    <img src="safaricom.png" alt="Safaricom">
                    <span>Safaricom</span>
                </div>
                <div class="provider-option" onclick="selectProvider('airtel')" id="provider-airtel">
                    <img src="airtel.png" alt="Airtel">
                    <span>Airtel</span>
                </div>
                <div class="provider-option" onclick="selectProvider('telkom')" id="provider-telkom">
                    <img src="telkom.png" alt="Telkom">
                    <span>Telkom</span>
                </div>
            </div>
        </div>

        <!-- Purchase Form -->
        <div class="card">
            <div class="section-title">Top-up Details</div>
            <form id="purchaseForm" onsubmit="handlePurchase(event)">
                <div class="form-group">
                    <label>
                        Number to Buy Airtime
                        <span class="tooltip-icon" data-tooltip="Enter the phone number to receive airtime">?</span>
                    </label>
                    <input type="tel" id="airtimeNumber" placeholder="e.g., 0712345678" required>
                    <div class="error-message" id="airtimeNumberError">Please enter a valid phone number</div>
                </div>

                <div class="form-group">
                    <label>
                        Number to Pay for Airtime
                        <span class="tooltip-icon" data-tooltip="Enter M-PESA number for payment">?</span>
                    </label>
                    <input type="tel" id="paymentNumber" placeholder="e.g., 0712345678" required>
                    <div class="error-message" id="paymentNumberError">Please enter a valid phone number</div>
                </div>

                <div class="form-group">
                    <label>
                        Amount (KSH 5 - 200)
                        <span class="tooltip-icon" data-tooltip="Minimum: 5 KSH, Maximum: 200 KSH + Get 5% Bonus!">?</span>
                    </label>
                    <input type="number" id="amount" placeholder="Enter amount" min="5" max="200" required>
                    <div class="error-message" id="amountError">Amount must be between 5 and 200 KSH</div>
                </div>

                <button type="submit" class="btn" id="submitBtn">Purchase Airtime</button>
            </form>
        </div>

        <!-- News Section -->
        <div class="news-section">
            <div class="news-header">
                <div class="news-title">Latest News</div>
                <div class="news-controls">
                    <button class="news-btn" onclick="changeNews(-1)">←</button>
                    <button class="news-btn" onclick="changeNews(1)">→</button>
                </div>
            </div>
            <div id="newsContainer"></div>
        </div>
    </div>

    <!-- Footer -->
    <div class="footer">
        <div class="footer-links">
            <a href="#" onclick="openPopup('about')">About Us</a>
            <a href="#" onclick="openPopup('contact')">Contact Us</a>
            <a href="#" onclick="openPopup('privacy')">Privacy Policy</a>
            <a href="#" onclick="openPopup('refund')">Refund Policy</a>
            <a href="#" onclick="openPopup('terms')">Terms & Conditions</a>
            <a href="#" onclick="openPopup('faq')">FAQ</a>
        </div>
        <div class="copyright">© 2024 Etopup. All Rights Reserved.</div>
    </div>

    <!-- Menu Popup -->
    <div class="popup-overlay" id="menuPopup">
        <div class="popup-content">
            <button class="close-btn" onclick="closePopup('menuPopup')">×</button>
            <div class="popup-title">Menu</div>
            <div class="popup-text">
                <p style="margin-bottom: 15px;"><a href="#" onclick="openPopup('about')" style="color: #667eea; text-decoration: none; display: block; padding: 10px 0;">About Us</a></p>
                <p style="margin-bottom: 15px;"><a href="#" onclick="openPopup('contact')" style="color: #667eea; text-decoration: none; display: block; padding: 10px 0;">Contact Us</a></p>
                <p style="margin-bottom: 15px;"><a href="#" onclick="openPopup('privacy')" style="color: #667eea; text-decoration: none; display: block; padding: 10px 0;">Privacy Policy</a></p>
                <p style="margin-bottom: 15px;"><a href="#" onclick="openPopup('refund')" style="color: #667eea; text-decoration: none; display: block; padding: 10px 0;">Refund Policy</a></p>
                <p style="margin-bottom: 15px;"><a href="#" onclick="openPopup('how-to')" style="color: #667eea; text-decoration: none; display: block; padding: 10px 0;">How to Purchase</a></p>
                <p style="margin-bottom: 15px;"><a href="#" onclick="openPopup('terms')" style="color: #667eea; text-decoration: none; display: block; padding: 10px 0;">Terms & Conditions</a></p>
                <p style="margin-bottom: 15px;"><a href="#" onclick="openPopup('faq')" style="color: #667eea; text-decoration: none; display: block; padding: 10px 0;">FAQ</a></p>
            </div>
        </div>
    </div>

    <!-- Content Popups -->
    <div class="popup-overlay" id="contentPopup">
        <div class="popup-content">
            <button class="close-btn" onclick="closePopup('contentPopup')">×</button>
            <div class="popup-title" id="popupTitle"></div>
            <div class="popup-text" id="popupContent"></div>
        </div>
    </div>

    <!-- News Detail Popup -->
    <div class="popup-overlay" id="newsPopup">
        <div class="popup-content">
            <button class="close-btn" onclick="closePopup('newsPopup')">×</button>
            <div class="popup-title" id="newsPopupTitle"></div>
            <div class="popup-text" id="newsPopupContent"></div>
        </div>
    </div>

    <!-- Receipt Popup -->
    <div class="popup-overlay" id="receiptPopup">
        <div class="popup-content">
            <button class="close-btn" onclick="closePopup('receiptPopup')">×</button>
            <div class="popup-title">Transaction Receipt</div>
            <div class="popup-text" id="receiptContent"></div>
        </div>
    </div>

    <!-- Loading Overlay -->
    <div class="loading-overlay" id="loadingOverlay">
        <svg class="spinner" viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">
            <circle cx="50" cy="50" r="45" fill="#667eea"/>
            <path d="M30 50 L50 30 L70 50 L50 70 Z" fill="white"/>
            <circle cx="50" cy="50" r="8" fill="#764ba2"/>
            <path d="M50 25 Q65 35 50 50 Q35 35 50 25" fill="#ffd700" opacity="0.8"/>
        </svg>
        <div class="loading-text">Processing your request...</div>
        <div class="loading-text" style="font-size: 14px; margin-top: 10px;">Please wait for M-PESA prompt</div>
    </div>

    <!-- Notification Ticker -->
    <div class="notification-ticker">
        <div class="ticker-content">
            <span class="ticker-item">🎉 254712****78 received 100 KSH + 5 KSH bonus!</span>
            <span class="ticker-item">🎉 254701****45 received 50 KSH + 2.5 KSH bonus!</span>
            <span class="ticker-item">🎉 254722****90 received 200 KSH + 10 KSH bonus!</span>
            <span class="ticker-item">🎉 254733****12 received 150 KSH + 7.5 KSH bonus!</span>
            <span class="ticker-item">🎉 254745****67 received 75 KSH + 3.75 KSH bonus!</span>
        </div>
    </div>

    <script>
        const SERVER_URL = 'https://airtimepurchase.onrender.com';
        let selectedProvider = '';
        let currentNewsIndex = 0;

        const newsData = [
            {
                title: "Get 5% Bonus on Every Top-up!",
                excerpt: "Exciting news! All airtime purchases now include a 5% bonus...",
                full: "We're excited to announce that every airtime purchase on Etopup now comes with a 5% bonus! This means when you buy 100 KSH airtime, you'll receive 105 KSH total. The bonus is automatically added to your airtime and sent to your number instantly. There's no limit - the more you top up, the more bonus you get!"
            },
            {
                title: "Instant M-PESA Integration",
                excerpt: "Experience lightning-fast airtime delivery with our M-PESA integration...",
                full: "Our platform now features seamless M-PESA integration for instant payments. Simply enter your phone number, and you'll receive an STK push notification on your phone. Approve the payment, and your airtime (plus bonus!) will be delivered within seconds. No more waiting or manual confirmations needed!"
            },
            {
                title: "Support for All Major Networks",
                excerpt: "Buy airtime for Safaricom, Airtel, and Telkom networks...",
                full: "Etopup now supports all major Kenyan mobile networks including Safaricom, Airtel, and Telkom. Whether you're topping up for yourself or sending airtime to friends and family, we've got you covered. Select your preferred network and enjoy the same fast, reliable service across all providers."
            },
            {
                title: "Secure & Reliable Transactions",
                excerpt: "Your transactions are protected with bank-level security...",
                full: "At Etopup, we take security seriously. All transactions are encrypted with bank-level security protocols. Your payment information is never stored on our servers, and we use industry-standard authentication methods. Our system has processed thousands of transactions with a 99.9% success rate."
            },
            {
                title: "24/7 Customer Support Available",
                excerpt: "Need help? Our support team is available round the clock...",
                full: "We're here to help! Our customer support team is available 24/7 to assist with any questions or issues. Whether you need help with a transaction, have questions about our bonus program, or need technical assistance, we're just a message away. Contact us anytime through our support channels."
            }
        ];

        const contentData = {
            about: {
                title: "About Us",
                content: `<p>Etopup is Kenya's leading airtime top-up platform, providing fast, secure, and convenient mobile airtime services. We've partnered with all major mobile networks to bring you the best airtime purchasing experience.</p>
                <p style="margin-top: 15px;">Our mission is to make airtime purchases simple and rewarding. That's why we offer a 5% bonus on every top-up, instant delivery, and 24/7 customer support.</p>
                <p style="margin-top: 15px;">Join thousands of satisfied customers who trust Etopup for their airtime needs.</p>`
            },
            contact: {
                title: "Contact Us",
                content: `<p><strong>Email:</strong> support@etopup.co.ke</p>
                <p style="margin-top: 10px;"><strong>Phone:</strong> 0700 000 000</p>
                <p style="margin-top: 10px;"><strong>WhatsApp:</strong> 0700 000 000</p>
                <p style="margin-top: 10px;"><strong>Business Hours:</strong> 24/7</p>
                <p style="margin-top: 15px;">We typically respond to all inquiries within 1 hour.</p>`
            },
            privacy: {
                title: "Privacy Policy",
                content: `<p>At Etopup, we respect your privacy and are committed to protecting your personal information.</p>
                <p style="margin-top: 15px;"><strong>Information We Collect:</strong> We collect phone numbers and transaction data necessary to process your airtime purchases.</p>
                <p style="margin-top: 15px;"><strong>How We Use Your Data:</strong> Your information is used solely to process transactions and improve our services. We never sell or share your data with third parties.</p>
                <p style="margin-top: 15px;"><strong>Security:</strong> All data is encrypted and stored securely using industry-standard protocols.</p>`
            },
            refund: {
                title: "Refund Policy",
                content: `<p>We strive for 100% customer satisfaction. If you experience any issues with your purchase, we're here to help.</p>
                <p style="margin-top: 15px;"><strong>Eligible Refunds:</strong> Failed transactions where payment was deducted but airtime was not received.</p>
                <p style="margin-top: 15px;"><strong>Refund Process:</strong> Contact our support team within 24 hours with your transaction reference. Refunds are processed within 3-5 business days.</p>
                <p style="margin-top: 15px;"><strong>Note:</strong> Successful airtime deliveries cannot be refunded.</p>`
            },
            'how-to': {
                title: "How to Purchase",
                content: `<p><strong>Step 1:</strong> Select your mobile network provider (Safaricom, Airtel, or Telkom)</p>
                <p style="margin-top: 10px;"><strong>Step 2:</strong> Enter the phone number to receive airtime</p>
                <p style="margin-top: 10px;"><strong>Step 3:</strong> Enter the M-PESA number for payment</p>
                <p style="margin-top: 10px;"><strong>Step 4:</strong> Enter amount (5-200 KSH)</p>
                <p style="margin-top: 10px;"><strong>Step 5:</strong> Click "Purchase Airtime" and approve M-PESA prompt</p>
                <p style="margin-top: 10px;"><strong>Step 6:</strong> Receive airtime + 5% bonus instantly!</p>`
            },
            terms: {
                title: "Terms & Conditions",
                content: `<p>By using Etopup, you agree to the following terms:</p>
                <p style="margin-top: 15px;">1. All transactions are final once airtime is successfully delivered.</p>
                <p style="margin-top: 10px;">2. Minimum purchase amount is 5 KSH, maximum is 200 KSH per transaction.</p>
                <p style="margin-top: 10px;">3. 5% bonus airtime is automatically added to all successful purchases.</p>
                <p style="margin-top: 10px;">4. You must provide accurate phone numbers for transactions.</p>
                <p style="margin-top: 10px;">5. We reserve the right to refuse service for suspected fraudulent activity.</p>`
            },
            faq: {
                title: "FAQ",
                content: `<p><strong>Q: How long does airtime delivery take?</strong><br>A: Airtime is delivered instantly after payment confirmation, usually within 30 seconds.</p>
                <p style="margin-top: 15px;"><strong>Q: What is the 5% bonus?</strong><br>A: Every purchase automatically includes 5% extra airtime. For example, 100 KSH purchase gives you 105 KSH total.</p>
                <p style="margin-top: 15px;"><strong>Q: Can I buy for different networks?</strong><br>A: Yes! We support Safaricom, Airtel, and Telkom.</p>
                <p style="margin-top: 15px;"><strong>Q: What if payment deducts but no airtime received?</strong><br>A: Contact support immediately with your transaction reference for assistance.</p>`
            }
        };

        function selectProvider(provider) {
            selectedProvider = provider;
            document.querySelectorAll('.provider-option').forEach(el => {
                el.classList.remove('selected');
            });
            document.getElementById(`provider-${provider}`).classList.add('selected');
        }

        function validatePhone(phone) {
            const pattern = /^(0|254)?[17]\d{8}$/;
            return pattern.test(phone.replace(/\s/g, ''));
        }

        async function handlePurchase(event) {
            event.preventDefault();
            
            if (!selectedProvider) {
                alert('Please select a network provider');
                return;
            }

            const airtimeNumber = document.getElementById('airtimeNumber').value.trim();
            const paymentNumber = document.getElementById('paymentNumber').value.trim();
            const amount = parseInt(document.getElementById('amount').value);

            let hasError = false;

            // Validate airtime number
            if (!validatePhone(airtimeNumber)) {
                document.getElementById('airtimeNumber').classList.add('error');
                document.getElementById('airtimeNumberError').style.display = 'block';
                hasError = true;
            } else {
                document.getElementById('airtimeNumber').classList.remove('error');
                document.getElementById('airtimeNumberError').style.display = 'none';
            }

            // Validate payment number
            if (!validatePhone(paymentNumber)) {
                document.getElementById('paymentNumber').classList.add('error');
                document.getElementById('paymentNumberError').style.display = 'block';
                hasError = true;
            } else {
                document.getElementById('paymentNumber').classList.remove('error');
                document.getElementById('paymentNumberError').style.display = 'none';
            }

            // Validate amount
            if (isNaN(amount) || amount < 5 || amount > 200) {
                document.getElementById('amount').classList.add('error');
                document.getElementById('amountError').style.display = 'block';
                hasError = true;
            } else {
                document.getElementById('amount').classList.remove('error');
                document.getElementById('amountError').style.display = 'none';
            }

            if (hasError) return;

            // Show loading
            document.getElementById('loadingOverlay').classList.add('active');

            try {
                const response = await fetch(`${SERVER_URL}/purchase`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        payment_number: paymentNumber,
                        airtime_number: airtimeNumber,
                        amount: amount
                    })
                });

                const result = await response.json();

                // Hide loading
                document.getElementById('loadingOverlay').classList.remove('active');

                if (result.success) {
                    // Calculate bonus
                    const bonusAmount = Math.floor(amount * 0.05);
                    const totalAmount = amount + bonusAmount;

                    // Show receipt
                    const receiptHTML = `
                        <div style="background: #f5f5f5; padding: 20px; border-radius: 10px; margin-bottom: 15px;">
                            <h3 style="color: #667eea; margin-bottom: 15px;">✅ Transaction Successful!</h3>
                            <p style="margin: 10px 0;"><strong>Reference:</strong> ${result.reference || 'N/A'}</p>
                            <p style="margin: 10px 0;"><strong>Airtime Number:</strong> ${airtimeNumber}</p>
                            <p style="margin: 10px 0;"><strong>Payment Number:</strong> ${paymentNumber}</p>
                            <p style="margin: 10px 0;"><strong>Base Amount:</strong> ${amount} KSH</p>
                            <p style="margin: 10px 0;"><strong>Bonus (5%):</strong> ${bonusAmount} KSH</p>
                            <p style="margin: 10px 0;"><strong>Total Airtime:</strong> <span style="color: #4caf50; font-size: 20px; font-weight: bold;">${totalAmount} KSH</span></p>
                            <p style="margin: 10px 0;"><strong>Provider:</strong> ${selectedProvider.charAt(0).toUpperCase() + selectedProvider.slice(1)}</p>
                            <p style="margin: 10px 0;"><strong>Status:</strong> <span style="color: #4caf50;">Processing</span></p>
                        </div>
                        <p style="color: #666; font-size: 14px;">Please check your M-PESA for payment prompt. Airtime will be delivered once payment is confirmed.</p>
                    `;
                    
                    document.getElementById('receiptContent').innerHTML = receiptHTML;
                    document.getElementById('receiptPopup').classList.add('active');

                    // Reset form
                    document.getElementById('purchaseForm').reset();
                    selectedProvider = '';
                    document.querySelectorAll('.provider-option').forEach(el => {
                        el.classList.remove('selected');
                    });
                } else {
                    alert('Transaction failed: ' + (result.message || 'Unknown error'));
                }
            } catch (error) {
                document.getElementById('loadingOverlay').classList.remove('active');
                alert('Error: ' + error.message);
            }
        }

        function toggleMenu() {
            document.getElementById('menuPopup').classList.add('active');
        }

        function closePopup(popupId) {
            document.getElementById(popupId).classList.remove('active');
        }

        function openPopup(type) {
            closePopup('menuPopup');
            
            if (contentData[type]) {
                document.getElementById('popupTitle').textContent = contentData[type].title;
                document.getElementById('popupContent').innerHTML = contentData[type].content;
                document.getElementById('contentPopup').classList.add('active');
            }
        }

        function renderNews() {
            const newsContainer = document.getElementById('newsContainer');
            newsContainer.innerHTML = '';
            
            const news = newsData[currentNewsIndex];
            const newsItem = document.createElement('div');
            newsItem.className = 'news-item';
            newsItem.innerHTML = `
                <h3>${news.title}</h3>
                <p>${news.excerpt}</p>
            `;
            newsItem.onclick = () => openNewsPopup(currentNewsIndex);
            newsContainer.appendChild(newsItem);
        }

        function changeNews(direction) {
            currentNewsIndex = (currentNewsIndex + direction + newsData.length) % newsData.length;
            renderNews();
        }

        function openNewsPopup(index) {
            const news = newsData[index];
            document.getElementById('newsPopupTitle').textContent = news.title;
            document.getElementById('newsPopupContent').textContent = news.full;
            document.getElementById('newsPopup').classList.add('active');
        }

        // Initialize
        renderNews();

        // Close popups when clicking overlay
        document.querySelectorAll('.popup-overlay').forEach(overlay => {
            overlay.addEventListener('click', (e) => {
                if (e.target === overlay) {
                    overlay.classList.remove('active');
                }
            });
        });
    </script>
</body>
                    </html>
